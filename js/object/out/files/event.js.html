<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>event.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ResponsiveAxis.html">ResponsiveAxis</a></li>
                                <li><a href="../classes/ResponsiveBrush.html">ResponsiveBrush</a></li>
                                <li><a href="../classes/ResponsiveEvent.html">ResponsiveEvent</a></li>
                                <li><a href="../classes/ResponsiveTooltip.html">ResponsiveTooltip</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: event.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * &lt;b&gt;Responsive Event For d3js library :&lt;/b&gt;&lt;br/&gt;
 * &lt;br/&gt;
 * Responive event allows you to define only one event for all devices by extension. &lt;br/&gt;
 * To instantiate one, you need to pass the following parameters into a json object :&lt;br/&gt;
 * &lt;b&gt;object&lt;/b&gt; : object which listen to events (required)&lt;br/&gt;
 * &lt;b&gt;events&lt;/b&gt; : list of events that can be extended
 * associated with function listen by the object (required)&lt;br/&gt;
 * &lt;br/&gt;
 * &lt;b&gt;Example:&lt;/b&gt;&lt;br/&gt;
 * new ResponsiveEvent({&lt;br/&gt;
 *      &amp;nbsp;&amp;nbsp;&amp;nbsp;object : window,&lt;br/&gt;
 *      &amp;nbsp;&amp;nbsp;&amp;nbsp;events : [&lt;br/&gt;
 *          &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&quot;name&quot; : &quot;mousemove&quot;, &quot;func&quot;: function1, &quot;extend&quot;: true},&lt;br/&gt;
 *          &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&quot;name&quot; : &quot;mouseout&quot;, &quot;func&quot;: function2, &quot;extend&quot;: false,&lt;br/&gt;
 *          &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&quot;name&quot; : &quot;touchend&quot;, &quot;func&quot;: function3, &quot;extend&quot;: false}&lt;br/&gt;
 *      &amp;nbsp;&amp;nbsp;&amp;nbsp;]&lt;br/&gt;
 * })()&lt;br/&gt;
 * &lt;br/&gt;
 * &lt;b&gt;Mapped events&lt;/b&gt;
 * &lt;table&gt;
 * &lt;tr&gt;&lt;th&gt;Mouse&lt;/th&gt;&lt;th&gt;Touch&lt;/th&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;mousedown&lt;/td&gt;&lt;td&gt;touchstart&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;mouseup&lt;/td&gt;&lt;td&gt;touchenter&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;mouseover&lt;/td&gt;&lt;td&gt;mouseover&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;mouseout&lt;/td&gt;&lt;td&gt;touchleave&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;mousemove&lt;/td&gt;&lt;td&gt;touchmove&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;click&lt;/td&gt;&lt;td&gt;tap&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;dblclick&lt;/td&gt;&lt;td&gt;doubletap&lt;/td&gt;&lt;tr&gt;
 * &lt;tr&gt;&lt;td&gt;mousecancel (fake)&lt;/td&gt;&lt;td&gt;touchcancel&lt;/td&gt;&lt;tr&gt;
 * &lt;/table&gt;
 * &lt;/br&gt;
 * @class ResponsiveEvent
 * @constructor
 * @version 0.1
 * @author Leclaire Juliana
 * @support d3js v3
 */
function ResponsiveEvent(options) {
    options = {
        /**
         * Object which listen to events&lt;br/&gt;
         * Read with : object.g()&lt;br/&gt;
         * Write with : object.g(newValue)&lt;br/&gt;
         * 
         * @attribute object
         * @public
         * @required
         * @type Object
         */
        object: options.object,
        /**
         * List of events that can be extended
         * associated with function listen by the object&lt;br/&gt;
         * Read with : axis.events()&lt;br/&gt;
         * Write with : axis.events(newValue)&lt;br/&gt;
         * 
         * @attribute events
         * @public
         * @required
         * @type Object
         */
        events: options.events,
        /**
         * 
         * 
         * @attribute eventsId
         * @public
         * @required
         * @type Object
         */
        eventsId: {}
    };

    mapEvents = {
        &quot;mousedown&quot;: &quot;touchstart&quot;,
        &quot;mouseup&quot;: &quot;touchend&quot;,
        &quot;mouseover&quot;:&quot;touchenter&quot;,
        &quot;mouseout&quot;: &quot;touchleave&quot;,
        &quot;mousemove&quot;: &quot;touchmove&quot;,
        &quot;click&quot;: &quot;tap&quot;,
        &quot;dblclick&quot;: &quot;doubletap&quot;,
        &quot;mousecancel&quot;:&quot;touchcancel&quot; // Fake event
    };

    /**
     * ResponsiveEvent Constructor
     *
     * @method my
     * @public
     * @constructor
     */
    function my() {
    	
        // Create getters and setters for options
        $$ResponsiveUtil.generateAccessors(my, options);

        // Create d3js event properties
        my.initProperties();

        return my;
    }

    /**
     * This method init properties for axis
     * 
     * @method initProperties
     * @private
     */
    my.initProperties = function () {
        my.events().forEach(function (event) {
            if (event.extend) {
                var mappedEvent = my.getMappedEvent(event.name);
                if (mappedEvent !== &quot;&quot;) {
                	my.initEvent(mappedEvent, event.func);
                }
            }
            my.initEvent(event.name, event.func);
        });
    };
    
    /**
     * Define event on current obj
     * 
     * @method initEvent
     * @public
     * @param {String} event name of event to define 
     * @param {Function} func function to invoke when event is triggered
     */
    my.initEvent = function(event, func){
    	if(my.isMouseEvent(event)){
    		my.object().on(event, func);
    	}
    	else if($$ResponsiveUtil.mobile()) {
    		my.object().on(event, my.intercept);
    		var id = my.generateId();
    		my.events()[event] = id;
            my.object().on(event + &quot;_&quot; + id, func); // Create a fake event
    	}
    };

    /**
     * Intercept the touch event triggered by the user in order to transform it
     * 
     * @method intercept
     * @private
     */
    my.intercept = function(){
    	var event = window.event;
        // Touch Event
        if(event instanceof TouchEvent){
            my.transformEvent(event, event.type);
        }
        // Hammer Event
        else if(event instanceof Event &amp;&amp; event.gesture){
            my.transformEvent(event.gesture.srcEvent, event.type);
        }
    };
    
    /**
     * Transform a touch event into mouse event and dispatch it
     * 
     * @method transformEvent
     * @private
     * @param {Event} event Hammer Event or Touch Event to transform
     * @param {String} type name of event
     */
    my.transformEvent = function(event, type) {
        var touches = event.changedTouches;
        var first = touches.item(0);
        var id = my.events()[type];
        var type = type + &quot;_&quot; + id;
        
        //initMouseEvent(type, canBubble, cancelable, view, clickCount, 
        //           screenX, screenY, clientX, clientY, ctrlKey, 
        //           altKey, shiftKey, metaKey, button, relatedTarget);

        var simulatedEvent = document.createEvent(&quot;MouseEvent&quot;);
        simulatedEvent.initMouseEvent(type, true, true, window, 1,
                first.screenX, first.screenY,
                first.clientX, first.clientY, false,
                false, false, false, 0/*left*/, null);
        
        // Set the srcEvent
        simulatedEvent.srcEvent = event;

        // Trigger the new fake event
        first.target.dispatchEvent(simulatedEvent);
        
        // Stop the old event
        event.preventDefault();
    };

    /**
     * Indicate if event name pass in parameter is mouse event
     * 
     * @method isMouseEvent
     * @private
     * @param {String} event to check
     * @return {Boolean} true if event is mouse event
     */
    my.isMouseEvent = function (event) {
    	return mapEvents.hasOwnProperty(event);
    };
    
    /**
     * Method that retrieves 
     * the mapped event to event pass in parameter
     * 
     * @method getMappedEvent
     * @private
     * @param {String} event name of event to get the matching event 
     * @return {String} event name of mapped event
     */
    my.getMappedEvent = function (event) {
        var mappedEvent = &quot;&quot;;
        if (mapEvents.hasOwnProperty(event)) {
            mappedEvent = mapEvents[event];
        }
        else {
            for (var e in mapEvents) {
                if (mapEvents[e] === event) {
                    mappedEvent = e;
                    break;
                }
            }
        }
        return mappedEvent;
    };
    
    /**
     * Method that generates unique id
     * 
     * @method generateId
     * @private
     * @return {String} an unique id
     */
    my.generateId = function () {
    	var time = new Date().getTime();
        return time;
    };

    return my;
}
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
